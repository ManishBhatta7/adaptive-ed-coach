import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import Backend from 'i18next-http-backend';
import LanguageDetector from 'i18next-browser-languagedetector';

// Import translation files
import enTranslations from './locales/en/common.json';
import esTranslations from './locales/es/common.json';
import frTranslations from './locales/fr/common.json';
import deTranslations from './locales/de/common.json';
import zhTranslations from './locales/zh/common.json';
import jaTranslations from './locales/ja/common.json';
import arTranslations from './locales/ar/common.json';
import ptTranslations from './locales/pt/common.json';
import ruTranslations from './locales/ru/common.json';
import koTranslations from './locales/ko/common.json';
import orTranslations from './locales/or/common.json';

export const supportedLanguages = [
  { code: 'en', name: 'English', nativeName: 'English', flag: 'üá∫üá∏' },
  { code: 'or', name: 'Odia', nativeName: '‡¨ì‡¨°‡¨º‡¨ø‡¨Ü', flag: 'üáÆüá≥' },
  { code: 'es', name: 'Spanish', nativeName: 'Espa√±ol', flag: 'üá™üá∏' },
  { code: 'fr', name: 'French', nativeName: 'Fran√ßais', flag: 'üá´üá∑' },
  { code: 'de', name: 'German', nativeName: 'Deutsch', flag: 'üá©üá™' },
  { code: 'zh', name: 'Chinese', nativeName: '‰∏≠Êñá', flag: 'üá®üá≥' },
  { code: 'ja', name: 'Japanese', nativeName: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ' },
  { code: 'ar', name: 'Arabic', nativeName: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', flag: 'üá∏üá¶' },
  { code: 'pt', name: 'Portuguese', nativeName: 'Portugu√™s', flag: 'üáµüáπ' },
  { code: 'ru', name: 'Russian', nativeName: '–†—É—Å—Å–∫–∏–π', flag: 'üá∑üá∫' },
  { code: 'ko', name: 'Korean', nativeName: 'ÌïúÍµ≠Ïñ¥', flag: 'üá∞üá∑' },
];

export const rtlLanguages = ['ar', 'he', 'fa', 'ur'];

const resources = {
  en: { common: enTranslations },
  or: { common: orTranslations },
  es: { common: esTranslations },
  fr: { common: frTranslations },
  de: { common: deTranslations },
  zh: { common: zhTranslations },
  ja: { common: jaTranslations },
  ar: { common: arTranslations },
  pt: { common: ptTranslations },
  ru: { common: ruTranslations },
  ko: { common: koTranslations },
};

// Cultural formatting utilities
export const getCultureConfig = (language: string) => {
  const configs: { [key: string]: any } = {
    en: {
      dateFormat: 'MM/DD/YYYY',
      timeFormat: 'h:mm A',
      currency: 'USD',
      numberFormat: '1,234.56',
      firstDayOfWeek: 0, // Sunday
      direction: 'ltr',
    },
    es: {
      dateFormat: 'DD/MM/YYYY',
      timeFormat: 'HH:mm',
      currency: 'EUR',
      numberFormat: '1.234,56',
      firstDayOfWeek: 1, // Monday
      direction: 'ltr',
    },
    fr: {
      dateFormat: 'DD/MM/YYYY',
      timeFormat: 'HH:mm',
      currency: 'EUR',
      numberFormat: '1 234,56',
      firstDayOfWeek: 1, // Monday
      direction: 'ltr',
    },
    de: {
      dateFormat: 'DD.MM.YYYY',
      timeFormat: 'HH:mm',
      currency: 'EUR',
      numberFormat: '1.234,56',
      firstDayOfWeek: 1, // Monday
      direction: 'ltr',
    },
    zh: {
      dateFormat: 'YYYY/MM/DD',
      timeFormat: 'HH:mm',
      currency: 'CNY',
      numberFormat: '1,234.56',
      firstDayOfWeek: 1, // Monday
      direction: 'ltr',
    },
    ja: {
      dateFormat: 'YYYY/MM/DD',
      timeFormat: 'HH:mm',
      currency: 'JPY',
      numberFormat: '1,234',
      firstDayOfWeek: 0, // Sunday
      direction: 'ltr',
    },
    ar: {
      dateFormat: 'DD/MM/YYYY',
      timeFormat: 'HH:mm',
      currency: 'SAR',
      numberFormat: '1,234.56',
      firstDayOfWeek: 6, // Saturday
      direction: 'rtl',
    },
    pt: {
      dateFormat: 'DD/MM/YYYY',
      timeFormat: 'HH:mm',
      currency: 'BRL',
      numberFormat: '1.234,56',
      firstDayOfWeek: 0, // Sunday
      direction: 'ltr',
    },
    ru: {
      dateFormat: 'DD.MM.YYYY',
      timeFormat: 'HH:mm',
      currency: 'RUB',
      numberFormat: '1 234,56',
      firstDayOfWeek: 1, // Monday
      direction: 'ltr',
    },
    ko: {
      dateFormat: 'YYYY.MM.DD',
      timeFormat: 'HH:mm',
      currency: 'KRW',
      numberFormat: '1,234',
      firstDayOfWeek: 0, // Sunday
      direction: 'ltr',
    },
    or: {
      dateFormat: 'DD/MM/YYYY',
      timeFormat: 'HH:mm',
      currency: 'INR',
      numberFormat: '1,23,456.78', // Indian number format
      firstDayOfWeek: 0, // Sunday
      direction: 'ltr',
    },
  };

  return configs[language] || configs.en;
};

// Date formatting with cultural awareness
export const formatDate = (date: Date | string, language?: string) => {
  const lang = language || i18n.language;
  const config = getCultureConfig(lang);
  
  if (typeof date === 'string') {
    date = new Date(date);
  }

  return new Intl.DateTimeFormat(lang, {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
  }).format(date);
};

export const formatTime = (date: Date | string, language?: string) => {
  const lang = language || i18n.language;
  
  if (typeof date === 'string') {
    date = new Date(date);
  }

  return new Intl.DateTimeFormat(lang, {
    hour: '2-digit',
    minute: '2-digit',
  }).format(date);
};

export const formatDateTime = (date: Date | string, language?: string) => {
  const lang = language || i18n.language;
  
  if (typeof date === 'string') {
    date = new Date(date);
  }

  return new Intl.DateTimeFormat(lang, {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit',
  }).format(date);
};

// Number formatting with cultural awareness
export const formatNumber = (number: number, language?: string) => {
  const lang = language || i18n.language;
  return new Intl.NumberFormat(lang).format(number);
};

export const formatCurrency = (amount: number, language?: string) => {
  const lang = language || i18n.language;
  const config = getCultureConfig(lang);
  
  return new Intl.NumberFormat(lang, {
    style: 'currency',
    currency: config.currency,
  }).format(amount);
};

export const formatPercentage = (value: number, language?: string) => {
  const lang = language || i18n.language;
  
  return new Intl.NumberFormat(lang, {
    style: 'percent',
    minimumFractionDigits: 1,
    maximumFractionDigits: 1,
  }).format(value);
};

// Relative time formatting
export const formatRelativeTime = (date: Date | string, language?: string) => {
  const lang = language || i18n.language;
  
  if (typeof date === 'string') {
    date = new Date(date);
  }

  const now = new Date();
  const diffInSeconds = Math.floor((now.getTime() - date.getTime()) / 1000);

  const rtf = new Intl.RelativeTimeFormat(lang, { numeric: 'auto' });

  if (diffInSeconds < 60) {
    return rtf.format(-diffInSeconds, 'second');
  } else if (diffInSeconds < 3600) {
    return rtf.format(-Math.floor(diffInSeconds / 60), 'minute');
  } else if (diffInSeconds < 86400) {
    return rtf.format(-Math.floor(diffInSeconds / 3600), 'hour');
  } else if (diffInSeconds < 2592000) {
    return rtf.format(-Math.floor(diffInSeconds / 86400), 'day');
  } else if (diffInSeconds < 31536000) {
    return rtf.format(-Math.floor(diffInSeconds / 2592000), 'month');
  } else {
    return rtf.format(-Math.floor(diffInSeconds / 31536000), 'year');
  }
};

// Pluralization helpers
export const getPlural = (count: number, singular: string, plural?: string, language?: string) => {
  const lang = language || i18n.language;
  const pr = new Intl.PluralRules(lang);
  const rule = pr.select(count);
  
  if (rule === 'one') {
    return singular;
  }
  
  return plural || `${singular}s`;
};

// Educational terms localization
export const getEducationalTerms = (language?: string) => {
  const lang = language || i18n.language;
  
  const terms: { [key: string]: { [key: string]: string } } = {
    en: {
      grade: 'Grade',
      assessment: 'Assessment',
      metacognition: 'Metacognition',
      reflection: 'Reflection',
      collaboration: 'Collaboration',
      tutor: 'Tutor',
      classroom: 'Classroom',
      student: 'Student',
      teacher: 'Teacher',
      progress: 'Progress',
      learning: 'Learning',
      knowledge: 'Knowledge',
      understanding: 'Understanding',
      thinking: 'Thinking',
      strategy: 'Strategy',
      skill: 'Skill',
      competency: 'Competency',
      objective: 'Objective',
      outcome: 'Outcome',
      feedback: 'Feedback',
    },
    es: {
      grade: 'Calificaci√≥n',
      assessment: 'Evaluaci√≥n',
      metacognition: 'Metacognici√≥n',
      reflection: 'Reflexi√≥n',
      collaboration: 'Colaboraci√≥n',
      tutor: 'Tutor',
      classroom: 'Aula',
      student: 'Estudiante',
      teacher: 'Profesor',
      progress: 'Progreso',
      learning: 'Aprendizaje',
      knowledge: 'Conocimiento',
      understanding: 'Comprensi√≥n',
      thinking: 'Pensamiento',
      strategy: 'Estrategia',
      skill: 'Habilidad',
      competency: 'Competencia',
      objective: 'Objetivo',
      outcome: 'Resultado',
      feedback: 'Retroalimentaci√≥n',
    },
    fr: {
      grade: 'Note',
      assessment: '√âvaluation',
      metacognition: 'M√©tacognition',
      reflection: 'R√©flexion',
      collaboration: 'Collaboration',
      tutor: 'Tuteur',
      classroom: 'Classe',
      student: '√âtudiant',
      teacher: 'Enseignant',
      progress: 'Progr√®s',
      learning: 'Apprentissage',
      knowledge: 'Connaissance',
      understanding: 'Compr√©hension',
      thinking: 'R√©flexion',
      strategy: 'Strat√©gie',
      skill: 'Comp√©tence',
      competency: 'Comp√©tence',
      objective: 'Objectif',
      outcome: 'R√©sultat',
      feedback: 'Retour',
    },
    de: {
      grade: 'Note',
      assessment: 'Bewertung',
      metacognition: 'Metakognition',
      reflection: 'Reflexion',
      collaboration: 'Zusammenarbeit',
      tutor: 'Tutor',
      classroom: 'Klassenzimmer',
      student: 'Student',
      teacher: 'Lehrer',
      progress: 'Fortschritt',
      learning: 'Lernen',
      knowledge: 'Wissen',
      understanding: 'Verst√§ndnis',
      thinking: 'Denken',
      strategy: 'Strategie',
      skill: 'F√§higkeit',
      competency: 'Kompetenz',
      objective: 'Ziel',
      outcome: 'Ergebnis',
      feedback: 'R√ºckmeldung',
    },
    zh: {
      grade: 'ÊàêÁª©',
      assessment: 'ËØÑ‰º∞',
      metacognition: 'ÂÖÉËÆ§Áü•',
      reflection: 'ÂèçÊÄù',
      collaboration: 'Âçè‰Ωú',
      tutor: 'ÂØºÂ∏à',
      classroom: 'ÊïôÂÆ§',
      student: 'Â≠¶Áîü',
      teacher: 'ÊïôÂ∏à',
      progress: 'ËøõÊ≠•',
      learning: 'Â≠¶‰π†',
      knowledge: 'Áü•ËØÜ',
      understanding: 'ÁêÜËß£',
      thinking: 'ÊÄùËÄÉ',
      strategy: 'Á≠ñÁï•',
      skill: 'ÊäÄËÉΩ',
      competency: 'ËÉΩÂäõ',
      objective: 'ÁõÆÊ†á',
      outcome: 'ÁªìÊûú',
      feedback: 'ÂèçÈ¶à',
    },
    ja: {
      grade: 'ÊàêÁ∏æ',
      assessment: 'Ë©ï‰æ°',
      metacognition: '„É°„ÇøË™çÁü•',
      reflection: 'ÊåØ„ÇäËøî„Çä',
      collaboration: 'ÂçîÂÉç',
      tutor: '„ÉÅ„É•„Éº„Çø„Éº',
      classroom: 'ÊïôÂÆ§',
      student: 'Â≠¶Áîü',
      teacher: 'ÊïôÂ∏´',
      progress: 'ÈÄ≤Ê≠©',
      learning: 'Â≠¶Áøí',
      knowledge: 'Áü•Ë≠ò',
      understanding: 'ÁêÜËß£',
      thinking: 'ÊÄùËÄÉ',
      strategy: 'Êà¶Áï•',
      skill: '„Çπ„Ç≠„É´',
      competency: 'ËÉΩÂäõ',
      objective: 'ÁõÆÊ®ô',
      outcome: 'ÊàêÊûú',
      feedback: '„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ',
    },
    ar: {
      grade: 'ÿßŸÑÿØÿ±ÿ¨ÿ©',
      assessment: 'ÿßŸÑÿ™ŸÇŸäŸäŸÖ',
      metacognition: 'ŸÖÿß Ÿàÿ±ÿßÿ° ÿßŸÑŸÖÿπÿ±ŸÅÿ©',
      reflection: 'ÿßŸÑÿ™ÿ£ŸÖŸÑ',
      collaboration: 'ÿßŸÑÿ™ÿπÿßŸàŸÜ',
      tutor: 'ÿßŸÑŸÖÿπŸÑŸÖ ÿßŸÑÿÆÿµŸàÿµŸä',
      classroom: 'ÿßŸÑŸÅÿµŸÑ ÿßŸÑÿØÿ±ÿßÿ≥Ÿä',
      student: 'ÿßŸÑÿ∑ÿßŸÑÿ®',
      teacher: 'ÿßŸÑŸÖÿπŸÑŸÖ',
      progress: 'ÿßŸÑÿ™ŸÇÿØŸÖ',
      learning: 'ÿßŸÑÿ™ÿπŸÑŸÖ',
      knowledge: 'ÿßŸÑŸÖÿπÿ±ŸÅÿ©',
      understanding: 'ÿßŸÑŸÅŸáŸÖ',
      thinking: 'ÿßŸÑÿ™ŸÅŸÉŸäÿ±',
      strategy: 'ÿßŸÑÿßÿ≥ÿ™ÿ±ÿßÿ™Ÿäÿ¨Ÿäÿ©',
      skill: 'ÿßŸÑŸÖŸáÿßÿ±ÿ©',
      competency: 'ÿßŸÑŸÉŸÅÿßÿ°ÿ©',
      objective: 'ÿßŸÑŸáÿØŸÅ',
      outcome: 'ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ©',
      feedback: 'ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ© ÿßŸÑÿ±ÿßÿ¨ÿπÿ©',
    },
  };

  return terms[lang] || terms.en;
};

// Initialize i18n
i18n
  .use(Backend)
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources,
    lng: 'en', // default language
    fallbackLng: 'en',
    debug: process.env.NODE_ENV === 'development',
    
    interpolation: {
      escapeValue: false, // React already escapes
    },

    detection: {
      order: ['localStorage', 'cookie', 'navigator', 'htmlTag'],
      caches: ['localStorage', 'cookie'],
    },

    react: {
      useSuspense: false,
    },

    backend: {
      loadPath: '/locales/{{lng}}/{{ns}}.json',
    },
  });

// Set document direction based on language
i18n.on('languageChanged', (language) => {
  const config = getCultureConfig(language);
  document.documentElement.setAttribute('dir', config.direction);
  document.documentElement.setAttribute('lang', language);
});

export default i18n;